<html>
<body>
<p>
<a href="https://github.com/laforge49/JActor2#readme">JActor2</a> &gt; <a href="../../index.html">Docs</a> &gt; <a href="../index.html">Tutorials</a> &gt; <a href="index.html">Core</a> &gt; SpeedReport
</p>
<h1>SpeedReport - PrinterAgent</h1>
<p>
<a href="SpeedReport.java">SpeedReport</a>
is a blade that prints a brief report that is useful when writing benchmarks.
The report is generated entirely on the same thread used by Printer.
</p>
<pre>
import org.agilewiki.jactor2.core.blades.misc.Printer;
import org.agilewiki.jactor2.core.blades.misc.PrinterAgent;
import org.agilewiki.jactor2.core.messages.SyncRequest;

public class SpeedReport extends PrinterAgent {
    private final String heading;
    private final long ns;
    private final long count;
    
    public static SyncRequest&lt;Void&gt; startSReq(
            final Printer _printer, 
        final String _heading, 
        final long _ns, 
        final long _count)
            throws Exception {
        return new SpeedReport(_printer, _heading, _ns, _count).startSReq();
    }

    public SpeedReport(
            final Printer _printer, 
            final String _heading, 
            final long _ns, 
            final long _count) throws Exception {
        super(_printer);
        heading = _heading;
        ns = _ns;
        count = _count;
    }
    
    @Override
    protected Void start() throws Exception {
        println("");
        println(heading);
        printf("Test duration in nanoseconds: %,d%n", ns);
        printf("Number of exchanges: %,d%n", count);
        printf("Exchanges per second: %,d%n%n", 1000000000L * count / ns);
        return null;
    }
}
</pre>
<h3>
<a href="../../api/org/agilewiki/jactor2/core/blades/misc/PrinterAgent.html">PrinterAgent</a>
</h3>
<pre>
public class SpeedReport extends PrinterAgent {
    ...
}
</pre>
<p>
PrinterAgent extends
<a href="../../api/org/agilewiki/jactor2/core/blades/SyncAgent.html">SyncAgentBase</a>,
which is to say that it is a blade that uses the same reactor as another blade.
This allows PrinterAgent to access the requests of Printer locally, without recourse to messages.
Local access to Printer means that PrinterAgent can easily implement protected methods, like println and printf,
for using the Printer blade.
</p>
<h3>
<a href="../../api/org/agilewiki/jactor2/core/blades/SyncAgent.html#startSReq()">startSReq</a>
</h3>
<pre>
    public static SyncRequest&lt;Void&gt; startSReq(
            final Printer _printer, 
        final String _heading, 
        final long _ns, 
        final long _count)
            throws Exception {
        return new SpeedReport(_printer, _heading, _ns, _count).startSReq();
    }
</pre>
<p>
Sync agents have a single request, startSReq, which is called only once.
So it makes a lot of sense to define a static method which creates the agent and returns the request.
</p>
<pre>
    @Override
    protected Void start() throws Exception {
        println("");
        println(heading);
        printf("Test duration in nanoseconds: %,d%n", ns);
        printf("Number of exchanges: %,d%n", count);
        printf("Exchanges per second: %,d%n%n", 1000000000L * count / ns);
        return null;
    }
</pre>
<p>
The 
<a href="../../api/org/agilewiki/jactor2/core/blades/SyncAgentBase.html#start()">start</a>
method provides the application logic for the startSReq implemented in SyncAgentBase.
Within this method the protected methods on PrinterAgent--println and printf--can be used
for printing the report.
</p>
<h3>
Test
</h3>
<p>
We will use the <a href="SpeedReportValidator.java">SpeedReportValidator</a> program to test SpeedReport:
</p>
<pre>
import org.agilewiki.jactor2.core.blades.misc.Printer;
import org.agilewiki.jactor2.core.facilities.Facility;

public class SpeedReportValidator {
    public static void main(final String[] _args) throws Exception {
        Facility facility = new Facility();
        try {
            Printer printer = Printer.stdoutSReq(facility).call();
            SpeedReport.startSReq(printer, "Speed Report Validation", 1000L, 1L).call();
        } finally {
            facility.close();
        }
    }
}

Output:

Speed Report Validation
Test duration in nanoseconds: 1,000
Number of exchanges: 1
Exchanges per second: 1,000,000
</pre>
<table style="border: 2px solid;" bgcolor="lightgray">
<tr>
<th style="padding: 5px;" bgcolor="lightyellow">
Main Thread
</th>
<th>
&nbsp;
</th>
<th style="padding: 5px;" bgcolor="lightyellow" colspan="2">
Isolation Reactor
</th>
</tr>
<tr>
<th style="padding: 5px;" bgcolor="lightyellow">
SpeedReportValidator
</th>
<th>
&nbsp;
</th>
<th style="padding: 5px;" bgcolor="lightyellow">
SpeedReport
</th>
<th style="padding: 5px;" bgcolor="lightyellow">
Printer
</th>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
call
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
wait
</td>
<td style="padding: 5px; text-align: center;">
---start-->
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
allocate thread
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
println ""
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
println
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
println heading
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
println
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf "Test duration in nanoseconds: %,d%n", ns
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf "Number of exchanges: %,d%n", count
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf "Exchanges per second: %,d%n%n", 1000000000L * count / ns
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf
</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
wakeup
</td>
<td style="padding: 5px; text-align: center;">
<--response: null---
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
release thread
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
close
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
</table>
</body>
</html>
