<html>
<body>
<p>
<a href="https://github.com/laforge49/JActor2#readme">JActor2</a> &gt; <a href="../../index.html">Docs</a> &gt; <a href="../index.html">Tutorials</a> &gt; <a href="index.html">Core</a> &gt; SpeedReport
</p>
<h1>SpeedReport - PrinterAgent</h1>
<p>
<a href="SpeedReport.java">SpeedReport</a>
is a SyncRequest that prints a brief report that is useful when writing benchmarks.
The report is generated entirely on the same thread used by Printer.
</p>
<pre>
import org.agilewiki.jactor2.core.blades.misc.Printer;
import org.agilewiki.jactor2.core.blades.misc.SyncPrinterRequest;
import org.agilewiki.jactor2.core.facilities.AsyncFacilityRequest;
import org.agilewiki.jactor2.core.facilities.Facility;
import org.agilewiki.jactor2.core.messages.AsyncRequest;

public class SpeedReport extends SyncPrinterRequest {
    
    public static AsyncRequest&lt;Void&gt; startAReq(
            final Facility _facility,
            final String _heading, 
            final long _ns, 
            final long _count) {
        return new AsyncFacilityRequest&lt;Void&gt;(_facility) {
            AsyncResponseProcessor dis = this;

            @Override
            public void processAsyncRequest() throws Exception {
                Printer printer = local(Printer.stdoutSReq(_facility));
                SpeedReport sr = new SpeedReport(printer, _heading, _ns, _count);
                send(sr, dis);
            }
        };
    }

    private final String heading;
    private final long ns;
    private final long count;
    
    private SpeedReport(final Printer _printer, 
            final String _heading, 
            final long _ns, 
            final long _count) throws Exception {
        super(_printer);
        heading = _heading;
        ns = _ns;
        count = _count;
    }

    @Override
    protected Void processSyncRequest() throws Exception {
        println("");
        println(heading);
        printf("Test duration in nanoseconds: %,d%n", ns);
        printf("Number of exchanges: %,d%n", count);
        if (ns > 0)
            printf("Exchanges per second: %,d%n%n", 1000000000L * count / ns);
        return null;
    }
}
</pre>
<h3>
<a href="../../api/org/agilewiki/jactor2/core/blades/misc/SyncPrinterRequest.html">SyncPrinterRequest</a>
</h3>
<pre>
public class SpeedReport extends SyncPrinterRequest {
    ...
}
</pre>
<p>
SyncPrinterRequest extends
<a href="../../api/org/agilewiki/jactor2/core/messages/SyncRequest.html">SyncRequest&lt;Void&gt;</a>.
SyncPrinterRequest accesses the public resources of Printer locally, without recourse to messages,
as it operates as an extension of Printer.
Local access to Printer means that SyncPrinterRequest can easily implement protected methods, i.e. println and printf,
for working with the Printer blade.
</p>
<h3>
Processing a SpeedReport Request
</h3>
<pre>
    @Override
    protected Void processSyncRequest() throws Exception {
        println("");
        println(heading);
        printf("Test duration in nanoseconds: %,d%n", ns);
        printf("Number of exchanges: %,d%n", count);
        if (ns > 0)
            printf("Exchanges per second: %,d%n%n", 1000000000L * count / ns);
        return null;
    }
</pre>
<p>
When processing a SpeedReport request, the println and printf methods inherited from SyncPrinterRequest can be used directly.
</p>
<h3>
<a href="../../api/org/agilewiki/jactor2/core/facilities/AsyncFacilityRequest.html">AsyncFacilityRequest</a>
</h3>
<pre>
    public static AsyncRequest&lt;Void&gt; startAReq(
            final Facility _facility,
            final String _heading, 
            final long _ns, 
            final long _count) {
        return new AsyncFacilityRequest&lt;Void&gt;(_facility) {
            ...
        };
    }
</pre>
<p>
AsyncFacilityRequest&lt;RESPONSE_TYPE&gt; extends
<a href="../../api/org/agilewiki/jactor2/core/messages/AsyncRequest.html">AsyncRequest&lt;RESPONSE_TYPE&gt;</a>.
Async requests are similar to sync requests, only the response must be passed back via the processAsyncMethod 
rather than with a return statement. And the local method does not apply to AsyncRequest.
Also you can send requests that are tied to other reactors in an AsyncRequest but you can not do that within
a SyncRequest.
</p>
<p>
AsyncFacilityRequest accesses the public resources of a facility locally, without recourse to messages,
as it operates as an extension of the facility's internal reactor.
</p>
<h3>
<a href="../../api/org/agilewiki/jactor2/core/messages/AsyncResponseProcessor.html">AsyncResponseProcessor</a>
</h3>
<pre>
            AsyncResponseProcessor dis = this;
</pre>
<p>
Subclasses of AsyncResponseProcessor are used to implement the logic that will be used to process a response.
So when you use a send, you typically instantiate an anonymous subclass with a processAsyncResponse method.
But AsyncRequest also implements the AsyncResponseProcessor to provide an easy means of passing back a result.
</p>
<h3>
<a href="../../api/org/agilewiki/jactor2/core/messages/AsyncRequest.html#processAsyncRequest()">processAsyncRequest</a>
</h3>
<pre>
            @Override
            public void processAsyncRequest() throws Exception {
                ...
            }
</pre>
<p>
The processAsyncRequest method is called when the request is to be processed.
It is similar to SyncRequest.processSyncRequest, except that processAsyncRequest has no return value.
</p>
<h3>
<a href="../../api/org/agilewiki/jactor2/core/blades/misc/Printer.html#stdoutSReq(org.agilewiki.jactor2.core.facilities.Facility)">stdoutSReq</a>
</h3>
<pre>
                Printer printer = local(Printer.stdoutSReq(_facility));
</pre>
<p>
The stdoutSReq method is a request to return the facility's  printer, safely creating and registering a printer
if there was none.
The request can be invoked using the local method because both the invoker and target of this request use the
same reactor.
</p>
<h3>
<a href="../../api/org/agilewiki/jactor2/core/messages/AsyncRequest.html#send(org.agilewiki.jactor2.core.messages.RequestBase, org.agilewiki.jactor2.core.messages.AsyncResponseProcessor)">send</a>
</h3>
<pre>
                SpeedReport sr = new SpeedReport(printer, _heading, _ns, _count);
                send(sr, dis);
</pre>
<p>
The send method invokes a request and provides a callback for processing the response.
In this case, the response is sent back to the invoker of startAReq.
The alternative is usually to create a subclass of AsyncResponseProcessor, but that would be
pretty redundant in this case:
</p>
<pre>
                send(sr, new AsyncResponseProcessor&lt;Void&gt;() {
                    @Override
                    public void processAsyncResponse(final Void _response) throws Exception {
                        dis.processAsyncResponse(null);
                    }
                });
</pre>
<h3>
Test
</h3>
<p>
We will use the <a href="SpeedReportValidator.java">SpeedReportValidator</a> program to test SpeedReport:
</p>
<pre>
import org.agilewiki.jactor2.core.blades.misc.Printer;
import org.agilewiki.jactor2.core.facilities.Facility;

public class SpeedReportValidator {
    public static void main(final String[] _args) throws Exception {
        Facility facility = new Facility();
        try {
            SpeedReport.startAReq(facility, "Speed Report Validation", 1000L, 1L).call();
        } finally {
            facility.close();
        }
    }
}

Output:

Speed Report Validation
Test duration in nanoseconds: 1,000
Number of exchanges: 1
Exchanges per second: 1,000,000
</pre>
<table style="border: 2px solid;" bgcolor="lightgray">
<tr>
<th style="padding: 5px;" bgcolor="lightyellow">
Main Thread
</th>
<th>
&nbsp;
</th>
<th style="padding: 5px;" bgcolor="lightyellow" colspan="2">
Isolation Reactor
</th>
</tr>
<tr>
<th style="padding: 5px;" bgcolor="lightyellow">
SpeedReportValidator
</th>
<th>
&nbsp;
</th>
<th style="padding: 5px;" bgcolor="lightyellow">
SpeedReport
</th>
<th style="padding: 5px;" bgcolor="lightyellow">
Printer
</th>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
call
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td>
&nbsp;
</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
wait
</td>
<td style="padding: 5px; text-align: center;">
---start-->
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
allocate thread
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
println ""
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
println
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
println heading
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
println
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf "Test duration in nanoseconds: %,d%n", ns
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf "Number of exchanges: %,d%n", count
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf "Exchanges per second: %,d%n%n", 1000000000L * count / ns
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
printf
</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
wakeup
</td>
<td style="padding: 5px; text-align: center;">
<--response: null---
</td>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
release thread
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="border: 1px solid; padding: 5px;" bgcolor="lightyellow">
close
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
<td style="padding: 5px;">
&nbsp;
</td>
</tr>
</table>
</body>
</html>
